<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Thailand Radio Quiet Zone Requirement Checker</title>
    <style>
        :root {
            --primary-color: #007bff;
            --secondary-color: #6c757d;
            --danger-color: #dc3545;
            --warning-color: #ffc107;
            --success-color: #28a745;
            --font-family: 'Arial', sans-serif;
            --background-color: #f8f9fa;
        }
        body {
            font-family: var(--font-family);
            margin: 0;
            padding: 0;
            background-color: var(--background-color);
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
        }
        .header {
            background-color: var(--primary-color);
            color: white;
            padding: 20px;
            text-align: center;
        }
        h1 {
            margin: 0;
            font-size: 24px;
        }
        .card {
            background-color: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin: 20px 0;
        }
        .card h2 {
            margin-top: 0;
            color: var(--primary-color);
        }
        input, button {
            padding: 10px;
            margin: 5px;
            border: 1px solid var(--secondary-color);
            border-radius: 4px;
            font-size: 16px;
        }
        button {
            cursor: pointer;
            background-color: var(--primary-color);
            color: white;
            border: none;
        }
        button:hover {
            background-color: darken(var(--primary-color), 10%);
        }
        #result, #pfdResult, #freqResult {
            font-size: 18px;
            margin-top: 20px;
            font-weight: bold;
        }
        #map {
            height: 300px;
            width: 100%;
            margin: 20px 0;
            border: 1px solid #ccc;
        }
        .formula {
            font-size: 16px;
            margin-top: 10px;
            color: var(--secondary-color);
        }
        .zone-description {
            color: var(--danger-color);
            font-weight: bold;
        }
        .zone-description.orange {
            color: var(--warning-color);
        }
        @media (min-width: 768px) {
            #map {
                height: 500px;
            }
        }
    </style>
    <link rel="stylesheet" href="https://unpkg.com/leaflet/dist/leaflet.css" />
</head>
<body>
    <div class="header">
        <h1>ตรวจสอบความสอดคล้องเบื้องต้นในพื้นที่ Radio Quiet Zone</h1>
    </div>
    <div class="container">
        <div class="card">
            <h2>ตรวจสอบพิกัดของสถานีที่สนใจ</h2>
            <p>กรุณาระบุพิกัดของสถานีที่สนใจ:</p>
            <label for="latitude">ละติจูด:</label>
            <input type="number" id="latitude" step="any" placeholder="ระบุพิกัด latitude">
            <label for="longitude">ลองจิจูด:</label>
            <input type="number" id="longitude" step="any" placeholder="ระบุพิกัด longitude">
            <button onclick="checkLocation()">ตรวจสอบพิกัด</button>
            <p id="result"></p>
            <div id="map"></div>
            <p class="zone-description">พื้นที่คุ้มครอง (3 km) เป็นพื้นที่โซนสีแดง: ไม่อนุญาตให้ตั้งสถานี</p>
            <p class="zone-description orange">พื้นที่ประสานงาน (20 km) เป็นพื้นที่โซนสีส้ม: สถานีที่สนใจต้องทำการประสานงานก่อน</p>
        </div>
        <div class="card">
            <h2>ตรวจสอบการทับซ้อนกับคลื่นความถี่วิทยุดาราศาสตร์</h2>
            <p>กรุณาระบุคลื่นความถี่ (หน่วย MHz):</p>
            <label for="lowerFreq">ความถี่เริ่มต้น:</label>
            <input type="number" id="lowerFreq" step="any" placeholder="ระบุคลื่นความถี่เริ่มต้น">
            <label for="upperFreq">ความถี่สิ้นสุด:</label>
            <input type="number" id="upperFreq" step="any" placeholder="ระบุคลื่นความถี่สิ้นสุด">
            <button onclick="checkFrequency()">ตรวจสอบคลื่นความถี่</button>
            <p id="freqResult"></p>
        </div>
        <div class="card">
            <h2>ตรวจสอบค่าความแรงระดับสัญญาณ Power Flux Density (PFD) เบื้องต้น</h2>
            <p>กรุณาระบุค่ากำลังส่ง EIRP (หน่วย Watts) ของสถานีที่สนใจ:</p>
            <label for="eirp">EIRP (W):</label>
            <input type="number" id="eirp" step="any" placeholder="ระบุค่า EIRP">
            <button onclick="calculatePFD()">ตรวจสอบระดับสัญญาณ</button>
            <p class="formula">สูตรการคำนวณ</p>
            <p class="formula">PFD (W/m²) = EIRP / (4πd²) โดย d คือระยะห่างจากตำแหน่งอ้างอิง (m)</p>
            <p class="formula">PFD (dBW/m²) = 10log10 (PFD (W/m²))</p>
            <p id="pfdResult"></p>
        </div>
        <button id="downloadPDF">ดาวน์โหลด PDF</button>
    </div>
    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.9.2/html2pdf.bundle.min.js"></script>
    <script>
        const referenceLat = 18.864036;
        const referenceLon = 99.216881;
        let calculatedDistance = 0;
        let pfdLimit = -57;
        let map, userMarker;

        window.onload = function () {
            map = L.map('map').setView([referenceLat, referenceLon], 12);
            L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
                attribution: '&copy; OpenStreetMap contributors'
            }).addTo(map);

            L.marker([referenceLat, referenceLon]).addTo(map)
                .bindPopup(`ตำแหน่งอ้างอิง: ${referenceLat}, ${referenceLon}`).openPopup();

            L.circle([referenceLat, referenceLon], {
                color: "red",
                fillColor: "#ff6666",
                fillOpacity: 0.3,
                radius: 3000
            }).addTo(map);

            L.circle([referenceLat, referenceLon], {
                color: "orange",
                fillColor: "#ffcc66",
                fillOpacity: 0.2,
                radius: 20000
            }).addTo(map);
        };

        function getDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // Radius of the Earth in km
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLon = (lon2 - lon1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) +
                Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) *
                Math.sin(dLon / 2) * Math.sin(dLon / 2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
            return R * c;
        }

        function checkLocation() {
            const lat = parseFloat(document.getElementById("latitude").value);
            const lon = parseFloat(document.getElementById("longitude").value);
            const result = document.getElementById("result");

            const latMin = 5.0, latMax = 20.0; // Example latitude range
            const lonMin = 97.0, lonMax = 105.0; // Example longitude range

            if (isNaN(lat) || isNaN(lon)) {
                result.textContent = "กรุณาในพิกัดในรูปแบบที่ถูกต้อง";
                result.style.color = "red";
                return;
            }

            if (lat < latMin || lat > latMax || lon < lonMin || lon > lonMax) {
                result.textContent = `พิกัดอยู่นอกช่วงที่กำหนด (ละติจูด: ${latMin} - ${latMax}, ลองจิจูด: ${lonMin} - ${lonMax})`;
                result.style.color = "red";
                return;
            }

            calculatedDistance = getDistance(referenceLat, referenceLon, lat, lon);
            let message;

            if (calculatedDistance <= 3) {
                message = `สถานีนี้อยู่ในพื้นที่คุ้มครอง (ระยะ: ${calculatedDistance.toFixed(2)} km จากตำแหน่งอ้างอิง)`;
                result.style.color = "red";
            } else if (calculatedDistance <= 20) {
                message = `สถานีนี้อยู่ในพื้นที่ประสานงาน (ระยะ: ${calculatedDistance.toFixed(2)} km จากตำแหน่งอ้างอิง)`;
                result.style.color = "orange";
            } else {
                message = `สถานีนี้ไม่อยู่ในพื้นที่ Radio Quiet Zone (ระยะ: ${calculatedDistance.toFixed(2)} km จากตำแหน่งอ้างอิง)`;
                result.style.color = "green";
            }

            result.textContent = message;

            if (userMarker) {
                map.removeLayer(userMarker);
            }
            userMarker = L.marker([lat, lon]).addTo(map).bindPopup(`สถานีใหม่: ${lat.toFixed(6)}, ${lon.toFixed(6)}`).openPopup();
        }

        function calculatePFD() {
            const eirp = parseFloat(document.getElementById("eirp").value);
            const pfdResult = document.getElementById("pfdResult");

            if (isNaN(eirp) || eirp <= 0) {
                pfdResult.textContent = "กรุณาระบุค่า EIRP ที่ถูกต้อง";
                pfdResult.style.color = "red";
                return;
            }

            if (calculatedDistance == 0) {
                pfdResult.textContent = "กรุณาระบุพิกัดของสถานีก่อน";
                pfdResult.style.color = "red";
                return;
            }

            const distanceMeters = calculatedDistance * 1000;
            const pfd = eirp / (4 * Math.PI * Math.pow(distanceMeters, 2));
            const pfd_dB = 10 * Math.log10(pfd);

            pfdResult.innerHTML = pfd_dB <= pfdLimit
                ? `✅ ค่า PFD ที่คำนวณได้: ${pfd_dB.toFixed(2)} dB(W/m²) ซึ่งไม่เกินระดับที่กำหนด (${pfdLimit} dB(W/m²))<br>ท่านสามารถใช้ผลการคำนวณนี้ประกอบคำขอรับอนุญาตได้โดยไม่ต้องทำการทดสอบเพิ่มเติม`
                : `❌ ค่า PFD ที่คำนวณได้: ${pfd_dB.toFixed(2)} dB(W/m²) เกินกว่าระดับที่กำหนด (${pfdLimit} dB(W/m²))<br>หากประสงค์จะใช้ค่าความแรงดังกล่าว กรุณาใช้โปรแกรมการตรวจสอบระดับความแรงสัญญาณที่ละเอียดขึ้น และแนบผลการคำนวณประกอบคำขอรับอนุญาต`;
            pfdResult.style.color = pfd_dB <= pfdLimit ? "green" : "red";
        }

        document.getElementById('downloadPDF').addEventListener('click', () => {
            const element = document.body; // You can change this to any specific part of the page you want to include in the PDF
            html2pdf()
                .from(element)
                .save();
        });
    </script>
</body>
</html>
